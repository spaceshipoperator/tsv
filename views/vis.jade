h1= config.name
// http://stackoverflow.com/questions/6270832/jade-express-iterating-over-object-in-inline-js-code-client-side
p
- if (chartType == 1)
  script(src='/javascripts/tsv.js')
- else
  script(src='/javascripts/bmc.js')
- if (typeof(series) != null)
  != "<script type='text/javascript'> "
  != "function initData() { "
  != "  var s = " + JSON.stringify(series) + "; "
  != "  var c = " + JSON.stringify(config) + "; "
  != "  plotSeries(s,c); "
  != "}"
  != "</script>"

script
  $('document').ready(function(){
    var f = '#{config.fromDate.value}',
      l = '#{config.series.value}'.split(','),
      m = '#{config.selectionScope.value}',
      t = '#{chartType}';

    $('[name="formOptions[series]"]').val(l);

    $('[name="formOptions[selectionScope]"]').val(m);

    $('[name="formOptions[chartType]"]').val(t);

    $('#formOptionsFromDate').val(f);

    $('#fromDatePicker').datepicker({ dateFormat: 'yy-mm-dd',
      defaultDate: f,
      onSelect: function(dateText, inst) {
        $('[name="formOptions[fromDate]"]').val(dateText);
        $('#formOptionsFromDate').val(dateText);
        var v = $('#formOptionsFromDate').val();
      }
    });

    $('#settings').hide();
    $('#displayText').click(function(){
      $('#settings').animate({"height": "toggle"}, { duration: 500 }); 
    }); 
  });

a#displayText(href="#", align="right") configure

body(onload="initData()", style="font-size:62.5%;")

div#settings
  form(method="post")
    table
      tr(valign="top")
        td
          fieldset
            legend=config.fromDate.label
            p
              input(name="formOptions[fromDate]", type="hidden", value=config.fromDate.value)
              div#fromDatePicker
        td
          fieldset
            legend=config.series.label
            p
              select(name="formOptions[series]", multiple, size=config.series.options.length)
                - for (var i in config.series.options)
                  - var e = config.series.options[i]
                  option(value=e[0])=e[1]
        td
          fieldset
            legend=config.selectionScope.label
            p
              select(name="formOptions[selectionScope]", size=config.selectionScope.options.length)
                - for (var i in config.selectionScope.options)
                  - var e = config.selectionScope.options[i]
                  option(value=e[0])=e[1]
        td
          fieldset
            legend chart type
            p
              select(name="formOptions[chartType]", size=2)
                option(value=1) line chart
                option(value=2) motion chart
    p.buttons
      input(type="submit", value="Go")
